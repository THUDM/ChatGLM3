# ChatGLM3

<p align="center">
ğŸ¤— <a href="https://huggingface.co/THUDM/chatglm3-6b" target="_blank">HF Repo</a> â€¢ ğŸ¤– <a href="https://modelscope.cn/models/ZhipuAI/chatglm3-6b" target="_blank">ModelScope</a> â€¢ ğŸ¤– <a href="https://www.wisemodel.cn/models/ZhipuAI/chatglm3-6b" target="_blank">WiseModel</a> â€¢ ğŸ§° <a href="https://openxlab.org.cn/models/hot/THUDM" target="_blank">OpenXLab</a> â€¢ ğŸ¦ <a href="https://twitter.com/thukeg" target="_blank">Twitter</a> â€¢ ğŸ“ƒ <a href="https://arxiv.org/abs/2103.10360" target="_blank">[GLM@ACL 22]</a> <a href="https://github.com/THUDM/GLM" target="_blank">[GitHub]</a> â€¢ ğŸ“ƒ <a href="https://arxiv.org/abs/2210.02414" target="_blank">[GLM-130B@ICLR 23]</a> <a href="https://github.com/THUDM/GLM-130B" target="_blank">[GitHub]</a> <br>
</p>
<p align="center">
    ğŸ‘‹ åŠ å…¥æˆ‘ä»¬çš„ <a href="https://join.slack.com/t/chatglm/shared_invite/zt-25ti5uohv-A_hs~am_D3Q8XPZMpj7wwQ" target="_blank">Slack</a> å’Œ <a href="resources/WECHAT.md" target="_blank">å¾®ä¿¡</a>
</p>
<p align="center">
ğŸ“åœ¨ <a href="https://www.chatglm.cn">chatglm.cn</a> ä½“éªŒæ›´å¤§è§„æ¨¡çš„ ChatGLM æ¨¡å‹ã€‚
</p>

[Read this in English.](./README_en.md)

ğŸ“” å…³äº`ChatGLM3-6B` æ›´ä¸ºè¯¦ç»†çš„ä½¿ç”¨ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ

+ [ChatGLM3 å¼€æ”¾æŠ€æœ¯æ–‡æ¡£](https://lslfd0slxc.feishu.cn/wiki/WvQbwIJ9tiPAxGk8ywDck6yfnof?from=from_copylink)
+ [Bilibili video](https://www.bilibili.com/video/BV1uC4y1J7yA)
+ [YouTube video](https://www.youtube.com/watch?v=Pw9PB6R7ORA)

## GLM-4 ä»‹ç»

æˆ‘ä»¬å·²ç»å‘å¸ƒæœ€æ–°çš„ **GLM-4** æ¨¡å‹ï¼Œè¯¥æ¨¡å‹åœ¨å¤šä¸ªæŒ‡æ ‡ä¸Šæœ‰äº†æ–°çš„çªç ´ï¼Œæ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ä¸¤ä¸ªæ¸ é“ä½“éªŒæˆ‘ä»¬çš„æœ€æ–°æ¨¡å‹ã€‚

+ [æ™ºè°±æ¸…è¨€](https://www.chatglm.cn) ä½“éªŒæœ€æ–°ç‰ˆ GLM-4ï¼ŒåŒ…æ‹¬ **GLMsï¼ŒAll tools**ç­‰åŠŸèƒ½ï¼Œä¸‹è½½ æ™ºè°±æ¸…è¨€ APP
  æˆ–è€…ä½¿ç”¨ [ç½‘é¡µç«¯](https://www.chatglm.cn)ã€‚
+ [APIå¹³å°](https://open.bigmodel.cn/) æ–°ä¸€ä»£ API å¹³å°å·²ç»ä¸Šçº¿ï¼Œæ‚¨å¯ä»¥ç›´æ¥åœ¨ API
  å¹³å°ä¸Šä½“éªŒ `GLM-4`ã€`GLM-3-Turbo`ã€`CharacterGLM-3`ï¼Œ`CogView-3` ç­‰æ–°æ¨¡å‹ã€‚
  å…¶ä¸­`GLM-4`ã€`GLM-3-Turbo`ä¸¤ä¸ªæ¨¡å‹æ”¯æŒäº† `System Prompt`ã€`Function Call`ã€ `Retrieval`ã€`Web_Search`ç­‰æ–°åŠŸèƒ½ï¼Œæ¬¢è¿ä½“éªŒã€‚

+ [GLM4 API å¼€æºæ•™ç¨‹](https://github.com/MetaGLM/glm-cookbook/) GLM-4 APIæ•™ç¨‹å’ŒåŸºç¡€åº”ç”¨ï¼Œæ¬¢è¿å°è¯•ã€‚
  APIç›¸å…³é—®é¢˜å¯ä»¥åœ¨æœ¬å¼€æºæ•™ç¨‹ç–‘é—®ï¼Œæˆ–è€…ä½¿ç”¨[GLM-4 API AIåŠ©æ‰‹](https://open.bigmodel.cn/shareapp/v1/?share_code=sQwt5qyqYVaNh1O_87p8O)
  æ¥è·å¾—å¸¸è§é—®é¢˜çš„å¸®åŠ©ã€‚

-----

## ChatGLM3 ä»‹ç»

**ChatGLM3** æ˜¯æ™ºè°±AIå’Œæ¸…åå¤§å­¦ KEG å®éªŒå®¤è”åˆå‘å¸ƒçš„å¯¹è¯é¢„è®­ç»ƒæ¨¡å‹ã€‚ChatGLM3-6B æ˜¯ ChatGLM3
ç³»åˆ—ä¸­çš„å¼€æºæ¨¡å‹ï¼Œåœ¨ä¿ç•™äº†å‰ä¸¤ä»£æ¨¡å‹å¯¹è¯æµç•…ã€éƒ¨ç½²é—¨æ§›ä½ç­‰ä¼—å¤šä¼˜ç§€ç‰¹æ€§çš„åŸºç¡€ä¸Šï¼ŒChatGLM3-6B å¼•å…¥äº†å¦‚ä¸‹ç‰¹æ€§ï¼š

1. **æ›´å¼ºå¤§çš„åŸºç¡€æ¨¡å‹ï¼š** ChatGLM3-6B çš„åŸºç¡€æ¨¡å‹ ChatGLM3-6B-Base
   é‡‡ç”¨äº†æ›´å¤šæ ·çš„è®­ç»ƒæ•°æ®ã€æ›´å……åˆ†çš„è®­ç»ƒæ­¥æ•°å’Œæ›´åˆç†çš„è®­ç»ƒç­–ç•¥ã€‚åœ¨è¯­ä¹‰ã€æ•°å­¦ã€æ¨ç†ã€ä»£ç ã€çŸ¥è¯†ç­‰ä¸åŒè§’åº¦çš„æ•°æ®é›†ä¸Šæµ‹è¯„æ˜¾ç¤ºï¼Œ*
   *ChatGLM3-6B-Base å…·æœ‰åœ¨ 10B ä»¥ä¸‹çš„åŸºç¡€æ¨¡å‹ä¸­æœ€å¼ºçš„æ€§èƒ½**ã€‚
2. **æ›´å®Œæ•´çš„åŠŸèƒ½æ”¯æŒï¼š** ChatGLM3-6B é‡‡ç”¨äº†å…¨æ–°è®¾è®¡çš„ [Prompt æ ¼å¼](PROMPT.md)
   ï¼Œé™¤æ­£å¸¸çš„å¤šè½®å¯¹è¯å¤–ã€‚åŒæ—¶åŸç”Ÿæ”¯æŒ[å·¥å…·è°ƒç”¨](tools_using_demo/README.md)ï¼ˆFunction Callï¼‰ã€ä»£ç æ‰§è¡Œï¼ˆCode Interpreterï¼‰å’Œ
   Agent ä»»åŠ¡ç­‰å¤æ‚åœºæ™¯ã€‚
3. **æ›´å…¨é¢çš„å¼€æºåºåˆ—ï¼š** é™¤äº†å¯¹è¯æ¨¡å‹ [ChatGLM3-6B](https://huggingface.co/THUDM/chatglm3-6b)
   å¤–ï¼Œè¿˜å¼€æºäº†åŸºç¡€æ¨¡å‹ [ChatGLM3-6B-Base](https://huggingface.co/THUDM/chatglm3-6b-base)
   ã€é•¿æ–‡æœ¬å¯¹è¯æ¨¡å‹ [ChatGLM3-6B-32K](https://huggingface.co/THUDM/chatglm3-6b-32k)
   å’Œè¿›ä¸€æ­¥å¼ºåŒ–äº†å¯¹äºé•¿æ–‡æœ¬ç†è§£èƒ½åŠ›çš„ [ChatGLM3-6B-128K](https://huggingface.co/THUDM/chatglm3-6b-128k)ã€‚ä»¥ä¸Šæ‰€æœ‰æƒé‡å¯¹å­¦æœ¯ç ”ç©¶**å®Œå…¨å¼€æ”¾**
   ï¼Œåœ¨å¡«å†™ [é—®å·](https://open.bigmodel.cn/mla/form) è¿›è¡Œç™»è®°å**äº¦å…è®¸å…è´¹å•†ä¸šä½¿ç”¨**ã€‚

-----

ChatGLM3 å¼€æºæ¨¡å‹æ—¨åœ¨ä¸å¼€æºç¤¾åŒºä¸€èµ·æ¨åŠ¨å¤§æ¨¡å‹æŠ€æœ¯å‘å±•ï¼Œæ³è¯·å¼€å‘è€…å’Œå¤§å®¶éµå®ˆ [å¼€æºåè®®](MODEL_LICENSE)
ï¼Œå‹¿å°†å¼€æºæ¨¡å‹å’Œä»£ç åŠåŸºäºå¼€æºé¡¹ç›®äº§ç”Ÿçš„è¡ç”Ÿç‰©ç”¨äºä»»ä½•å¯èƒ½ç»™å›½å®¶å’Œç¤¾ä¼šå¸¦æ¥å±å®³çš„ç”¨é€”ä»¥åŠç”¨äºä»»ä½•æœªç»è¿‡å®‰å…¨è¯„ä¼°å’Œå¤‡æ¡ˆçš„æœåŠ¡ã€‚ç›®å‰ï¼Œæœ¬é¡¹ç›®å›¢é˜ŸæœªåŸºäº
**ChatGLM3 å¼€æºæ¨¡å‹**å¼€å‘ä»»ä½•åº”ç”¨ï¼ŒåŒ…æ‹¬ç½‘é¡µç«¯ã€å®‰å“ã€è‹¹æœ iOS åŠ Windows App ç­‰åº”ç”¨ã€‚

å°½ç®¡æ¨¡å‹åœ¨è®­ç»ƒçš„å„ä¸ªé˜¶æ®µéƒ½å°½åŠ›ç¡®ä¿æ•°æ®çš„åˆè§„æ€§å’Œå‡†ç¡®æ€§ï¼Œä½†ç”±äº ChatGLM3-6B
æ¨¡å‹è§„æ¨¡è¾ƒå°ï¼Œä¸”æ¨¡å‹å—æ¦‚ç‡éšæœºæ€§å› ç´ å½±å“ï¼Œæ— æ³•ä¿è¯è¾“å‡ºå†…å®¹çš„å‡†ç¡®ã€‚åŒæ—¶æ¨¡å‹çš„è¾“å‡ºå®¹æ˜“è¢«ç”¨æˆ·çš„è¾“å…¥è¯¯å¯¼ã€‚*
*æœ¬é¡¹ç›®ä¸æ‰¿æ‹…å¼€æºæ¨¡å‹å’Œä»£ç å¯¼è‡´çš„æ•°æ®å®‰å…¨ã€èˆ†æƒ…é£é™©æˆ–å‘ç”Ÿä»»ä½•æ¨¡å‹è¢«è¯¯å¯¼ã€æ»¥ç”¨ã€ä¼ æ’­ã€ä¸å½“åˆ©ç”¨è€Œäº§ç”Ÿçš„é£é™©å’Œè´£ä»»ã€‚**

## æ¨¡å‹åˆ—è¡¨
                      
|      Model       | Seq Length |                                                                                                                                              Download                                                                                                                                    |
|:----------------:|:----------:|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
|   ChatGLM3-6B    |     8k     |        [HuggingFace](https://huggingface.co/THUDM/chatglm3-6b) \| [ModelScope](https://modelscope.cn/models/ZhipuAI/chatglm3-6b) \| [WiseModel](https://www.wisemodel.cn/models/ZhipuAI/chatglm3-6b)         \| [OpenXLab](https://openxlab.org.cn/models/detail/THUDM/chatglm3-6b)      |
| ChatGLM3-6B-Base |     8k     | [HuggingFace](https://huggingface.co/THUDM/chatglm3-6b-base) \| [ModelScope](https://modelscope.cn/models/ZhipuAI/chatglm3-6b-base) \| [WiseModel](https://www.wisemodel.cn/models/ZhipuAI/chatglm3-6b-base) \| [OpenXLabl](https://openxlab.org.cn/models/detail/THUDM/chatglm3-6b-base)|
| ChatGLM3-6B-32K  |    32k     |  [HuggingFace](https://huggingface.co/THUDM/chatglm3-6b-32k) \| [ModelScope](https://modelscope.cn/models/ZhipuAI/chatglm3-6b-32k) \| [WiseModel](https://www.wisemodel.cn/models/ZhipuAI/chatglm3-6b-32k)   \| [OpenXLab](https://openxlab.org.cn/models/detail/THUDM/chatglm3-6b-32k)  |
| ChatGLM3-6B-128K |    128k    |     [HuggingFace](https://huggingface.co/THUDM/chatglm3-6b-128k) ï½œ [ModelScope](https://modelscope.cn/models/ZhipuAI/chatglm3-6b-128k)\| [OpenXLab](https://openxlab.org.cn/models/detail/THUDM/chatglm3-6b-128k) |

<br> è¯·æ³¨æ„ï¼Œæ‰€æœ‰æ¨¡å‹çš„æœ€æ–°æ›´æ–°éƒ½ä¼šåœ¨ Huggingface ç‡å…ˆå‘å¸ƒã€‚ ModelScope å’Œ WiseModel ç”±äºæ²¡æœ‰ä¸ Huggingface åŒæ­¥ï¼Œéœ€è¦å¼€å‘äººå‘˜æ‰‹åŠ¨æ›´æ–°ï¼Œå¯èƒ½ä¼šåœ¨
Huggingface æ›´æ–°åä¸€æ®µæ—¶é—´å†…åŒæ­¥æ›´æ–°ã€‚

## å‹æƒ…é“¾æ¥

ä»¥ä¸‹ä¼˜ç§€å¼€æºä»“åº“å·²ç»å¯¹ ChatGLM3-6B æ¨¡å‹æ·±åº¦æ”¯æŒï¼Œæ¬¢è¿å¤§å®¶æ‰©å±•å­¦ä¹ ã€‚

æ¨ç†åŠ é€Ÿï¼š

* [chatglm.cpp](https://github.com/li-plus/chatglm.cpp): ç±»ä¼¼ llama.cpp çš„é‡åŒ–åŠ é€Ÿæ¨ç†æ–¹æ¡ˆï¼Œå®ç°ç¬”è®°æœ¬ä¸Šå®æ—¶å¯¹è¯
* [ChatGLM3-TPU](https://github.com/sophgo/ChatGLM3-TPU): é‡‡ç”¨TPUåŠ é€Ÿæ¨ç†æ–¹æ¡ˆï¼Œåœ¨ç®—èƒ½ç«¯ä¾§èŠ¯ç‰‡BM1684Xï¼ˆ16T@FP16ï¼Œå†…å­˜16Gï¼‰ä¸Šå®æ—¶è¿è¡Œçº¦7.5 token/s
* [TensorRT-LLM](https://github.com/NVIDIA/TensorRT-LLM/tree/main):
  NVIDIAå¼€å‘çš„é«˜æ€§èƒ½ GPU åŠ é€Ÿæ¨ç†æ–¹æ¡ˆï¼Œå¯ä»¥å‚è€ƒæ­¤ [æ­¥éª¤](./tensorrt_llm_demo/README.md) éƒ¨ç½² ChatGLM3-6B æ¨¡å‹
* [OpenVINO](https://github.com/openvinotoolkit): 
Intel å¼€å‘çš„é«˜æ€§èƒ½ CPU å’Œ GPU åŠ é€Ÿæ¨ç†æ–¹æ¡ˆï¼Œå¯ä»¥å‚è€ƒæ­¤ [æ­¥éª¤](./Intel_device_demo/openvino_demo/README.md) éƒ¨ç½² ChatGLM3-6B æ¨¡å‹

é«˜æ•ˆå¾®è°ƒï¼š

* [LLaMA-Factory](https://github.com/hiyouga/LLaMA-Factory): ä¼˜ç§€æ˜“ä¸Šæ‰‹çš„é«˜æ•ˆå¾®è°ƒæ¡†æ¶ã€‚

åº”ç”¨æ¡†æ¶ï¼š

* [LangChain-Chatchat](https://github.com/chatchat-space/Langchain-Chatchat): åŸºäº ChatGLM ç­‰å¤§è¯­è¨€æ¨¡å‹ä¸ Langchain
  ç­‰åº”ç”¨æ¡†æ¶å®ç°ï¼Œå¼€æºã€å¯ç¦»çº¿éƒ¨ç½²çš„æ£€ç´¢å¢å¼ºç”Ÿæˆ(RAG)å¤§æ¨¡å‹çŸ¥è¯†åº“é¡¹ç›®ã€‚

* [BISHENG](https://github.com/dataelement/bisheng): å¼€æºå¤§æ¨¡å‹åº”ç”¨å¼€å‘å¹³å°,èµ‹èƒ½å’ŒåŠ é€Ÿå¤§æ¨¡å‹åº”ç”¨å¼€å‘è½åœ°ï¼Œå¸®åŠ©ç”¨æˆ·ä»¥æœ€ä½³ä½“éªŒè¿›å…¥ä¸‹ä¸€ä»£åº”ç”¨å¼€å‘æ¨¡å¼ã€‚

* [RAGFlow](https://github.com/infiniflow/ragflow): RAGFlow æ˜¯ä¸€æ¬¾åŸºäºæ·±åº¦æ–‡æ¡£ç†è§£æ„å»ºçš„å¼€æº RAGï¼ˆRetrieval-Augmented Generationï¼‰å¼•æ“ã€‚å¯ä¸ºå„ç§è§„æ¨¡çš„ä¼ä¸šåŠä¸ªäººæä¾›ä¸€å¥—ç²¾ç®€çš„ RAG å·¥ä½œæµç¨‹ï¼Œç»“åˆå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰é’ˆå¯¹ç”¨æˆ·å„ç±»ä¸åŒçš„å¤æ‚æ ¼å¼æ•°æ®æä¾›å¯é çš„é—®ç­”ä»¥åŠæœ‰ç†æœ‰æ®çš„å¼•ç”¨ã€‚

## è¯„æµ‹ç»“æœ

### å…¸å‹ä»»åŠ¡

æˆ‘ä»¬é€‰å–äº† 8 ä¸ªä¸­è‹±æ–‡å…¸å‹æ•°æ®é›†ï¼Œåœ¨ ChatGLM3-6B (base) ç‰ˆæœ¬ä¸Šè¿›è¡Œäº†æ€§èƒ½æµ‹è¯•ã€‚

| Model            | GSM8K | MATH | BBH  | MMLU | C-Eval | CMMLU | MBPP | AGIEval |
|------------------|:-----:|:----:|:----:|:----:|:------:|:-----:|:----:|:-------:|
| ChatGLM2-6B-Base | 32.4  | 6.5  | 33.7 | 47.9 |  51.7  | 50.0  |  -   |    -    |
| Best Baseline    | 52.1  | 13.1 | 45.0 | 60.1 |  63.5  | 62.2  | 47.5 |  45.8   |
| ChatGLM3-6B-Base | 72.3  | 25.7 | 66.1 | 61.4 |  69.0  | 67.5  | 52.4 |  53.7   |

> Best Baseline æŒ‡çš„æ˜¯æˆªæ­¢ 2023å¹´10æœˆ27æ—¥ã€æ¨¡å‹å‚æ•°åœ¨ 10B ä»¥ä¸‹ã€åœ¨å¯¹åº”æ•°æ®é›†ä¸Šè¡¨ç°æœ€å¥½çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œä¸åŒ…æ‹¬åªé’ˆå¯¹æŸä¸€é¡¹ä»»åŠ¡è®­ç»ƒè€Œæœªä¿æŒé€šç”¨èƒ½åŠ›çš„æ¨¡å‹ã€‚

> å¯¹ ChatGLM3-6B-Base çš„æµ‹è¯•ä¸­ï¼ŒBBH é‡‡ç”¨ 3-shot æµ‹è¯•ï¼Œéœ€è¦æ¨ç†çš„ GSM8Kã€MATH é‡‡ç”¨ 0-shot CoT æµ‹è¯•ï¼ŒMBPP é‡‡ç”¨ 0-shot
> ç”Ÿæˆåè¿è¡Œæµ‹ä¾‹è®¡ç®— Pass@1 ï¼Œå…¶ä»–é€‰æ‹©é¢˜ç±»å‹æ•°æ®é›†å‡é‡‡ç”¨ 0-shot æµ‹è¯•ã€‚

æˆ‘ä»¬åœ¨å¤šä¸ªé•¿æ–‡æœ¬åº”ç”¨åœºæ™¯ä¸‹å¯¹ ChatGLM3-6B-32K è¿›è¡Œäº†äººå·¥è¯„ä¼°æµ‹è¯•ã€‚ä¸äºŒä»£æ¨¡å‹ç›¸æ¯”ï¼Œå…¶æ•ˆæœå¹³å‡æå‡äº†è¶…è¿‡
50%ã€‚åœ¨è®ºæ–‡é˜…è¯»ã€æ–‡æ¡£æ‘˜è¦å’Œè´¢æŠ¥åˆ†æç­‰åº”ç”¨ä¸­ï¼Œè¿™ç§æå‡å°¤ä¸ºæ˜¾è‘—ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜åœ¨ LongBench è¯„æµ‹é›†ä¸Šå¯¹æ¨¡å‹è¿›è¡Œäº†æµ‹è¯•ï¼Œå…·ä½“ç»“æœå¦‚ä¸‹è¡¨æ‰€ç¤º

| Model           |  å¹³å‡  | Summary | Single-Doc QA | Multi-Doc QA | Code | Few-shot | Synthetic | 
|-----------------|:----:|:-------:|:-------------:|:------------:|:----:|:--------:|:---------:|
| ChatGLM2-6B-32K | 41.5 |  24.8   |     37.6      |     34.7     | 52.8 |   51.3   |   47.7    | 
| ChatGLM3-6B-32K | 50.2 |  26.6   |     45.8      |     46.1     | 56.2 |   61.2   |    65     |

## ä½¿ç”¨æ–¹å¼

### ç¯å¢ƒå®‰è£…

é¦–å…ˆéœ€è¦ä¸‹è½½æœ¬ä»“åº“ï¼š

```shell
git clone https://github.com/THUDM/ChatGLM3
cd ChatGLM3
```

ç„¶åä½¿ç”¨ pip å®‰è£…ä¾èµ–ï¼š

```
pip install -r requirements.txt
```

+ ä¸ºäº†ä¿è¯ `torch` çš„ç‰ˆæœ¬æ­£ç¡®ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§ [å®˜æ–¹æ–‡æ¡£](https://pytorch.org/get-started/locally/) çš„è¯´æ˜å®‰è£…ã€‚

### ç»¼åˆ Demo

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªé›†æˆä»¥ä¸‹ä¸‰ç§åŠŸèƒ½çš„ç»¼åˆ Demoï¼Œè¿è¡Œæ–¹æ³•è¯·å‚è€ƒ[ç»¼åˆ Demo](composite_demo/README.md)

- Chat: å¯¹è¯æ¨¡å¼ï¼Œåœ¨æ­¤æ¨¡å¼ä¸‹å¯ä»¥ä¸æ¨¡å‹è¿›è¡Œå¯¹è¯ã€‚
- Tool: å·¥å…·æ¨¡å¼ï¼Œæ¨¡å‹é™¤äº†å¯¹è¯å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å·¥å…·è¿›è¡Œå…¶ä»–æ“ä½œã€‚

<img src="resources/tool.png" width="400">

- Code Interpreter: ä»£ç è§£é‡Šå™¨æ¨¡å¼ï¼Œæ¨¡å‹å¯ä»¥åœ¨ä¸€ä¸ª Jupyter ç¯å¢ƒä¸­æ‰§è¡Œä»£ç å¹¶è·å–ç»“æœï¼Œä»¥å®Œæˆå¤æ‚ä»»åŠ¡ã€‚

<img src="resources/heart.png" width="400">

### ä»£ç è°ƒç”¨

å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç è°ƒç”¨ ChatGLM æ¨¡å‹æ¥ç”Ÿæˆå¯¹è¯ï¼š

```python
>> > from transformers import AutoTokenizer, AutoModel
>> > tokenizer = AutoTokenizer.from_pretrained("THUDM/chatglm3-6b", trust_remote_code=True)
>> > model = AutoModel.from_pretrained("THUDM/chatglm3-6b", trust_remote_code=True, device='cuda')
>> > model = model.eval()
>> > response, history = model.chat(tokenizer, "ä½ å¥½", history=[])
>> > print(response)
ä½ å¥½ğŸ‘‹!æˆ‘æ˜¯äººå·¥æ™ºèƒ½åŠ©æ‰‹
ChatGLM3 - 6
B, å¾ˆé«˜å…´è§åˆ°ä½ , æ¬¢è¿é—®æˆ‘ä»»ä½•é—®é¢˜ã€‚
>> > response, history = model.chat(tokenizer, "æ™šä¸Šç¡ä¸ç€åº”è¯¥æ€ä¹ˆåŠ", history=history)
>> > print(response)
æ™šä¸Šç¡ä¸ç€å¯èƒ½ä¼šè®©ä½ æ„Ÿåˆ°ç„¦è™‘æˆ–ä¸èˆ’æœ, ä½†ä»¥ä¸‹æ˜¯ä¸€äº›å¯ä»¥å¸®åŠ©ä½ å…¥ç¡çš„æ–¹æ³•:

1.åˆ¶å®šè§„å¾‹çš„ç¡çœ æ—¶é—´è¡¨: ä¿æŒè§„å¾‹çš„ç¡çœ æ—¶é—´è¡¨å¯ä»¥å¸®åŠ©ä½ å»ºç«‹å¥åº·çš„ç¡çœ ä¹ æƒ¯, ä½¿ä½ æ›´å®¹æ˜“å…¥ç¡ã€‚å°½é‡åœ¨æ¯å¤©çš„ç›¸åŒæ—¶é—´ä¸ŠåºŠ, å¹¶åœ¨åŒä¸€æ—¶é—´èµ·åºŠã€‚
2.åˆ›é€ ä¸€ä¸ªèˆ’é€‚çš„ç¡çœ ç¯å¢ƒ: ç¡®ä¿ç¡çœ ç¯å¢ƒèˆ’é€‚, å®‰é™, é»‘æš—ä¸”æ¸©åº¦é€‚å®œã€‚å¯ä»¥ä½¿ç”¨èˆ’é€‚çš„åºŠä¸Šç”¨å“, å¹¶ä¿æŒæˆ¿é—´é€šé£ã€‚
3.æ”¾æ¾èº«å¿ƒ: åœ¨ç¡å‰åšäº›æ”¾æ¾çš„æ´»åŠ¨, ä¾‹å¦‚æ³¡ä¸ªçƒ­æ°´æ¾¡, å¬äº›è½»æŸ”çš„éŸ³ä¹, é˜…è¯»ä¸€äº›æœ‰è¶£çš„ä¹¦ç±ç­‰, æœ‰åŠ©äºç¼“è§£ç´§å¼ å’Œç„¦è™‘, ä½¿ä½ æ›´å®¹æ˜“å…¥ç¡ã€‚
4.é¿å…é¥®ç”¨å«æœ‰å’–å•¡å› çš„é¥®æ–™: å’–å•¡å› æ˜¯ä¸€ç§åˆºæ¿€æ€§ç‰©è´¨, ä¼šå½±å“ä½ çš„ç¡çœ è´¨é‡ã€‚å°½é‡é¿å…åœ¨ç¡å‰é¥®ç”¨å«æœ‰å’–å•¡å› çš„é¥®æ–™, ä¾‹å¦‚å’–å•¡, èŒ¶å’Œå¯ä¹ã€‚
5.é¿å…åœ¨åºŠä¸Šåšä¸ç¡çœ æ— å…³çš„äº‹æƒ…: åœ¨åºŠä¸Šåšäº›ä¸ç¡çœ æ— å…³çš„äº‹æƒ…, ä¾‹å¦‚çœ‹ç”µå½±, ç©æ¸¸æˆæˆ–å·¥ä½œç­‰, å¯èƒ½ä¼šå¹²æ‰°ä½ çš„ç¡çœ ã€‚
6.å°è¯•å‘¼å¸æŠ€å·§: æ·±å‘¼å¸æ˜¯ä¸€ç§æ”¾æ¾æŠ€å·§, å¯ä»¥å¸®åŠ©ä½ ç¼“è§£ç´§å¼ å’Œç„¦è™‘, ä½¿ä½ æ›´å®¹æ˜“å…¥ç¡ã€‚è¯•ç€æ…¢æ…¢å¸æ°”, ä¿æŒå‡ ç§’é’Ÿ, ç„¶åç¼“æ…¢å‘¼æ°”ã€‚

å¦‚æœè¿™äº›æ–¹æ³•æ— æ³•å¸®åŠ©ä½ å…¥ç¡, ä½ å¯ä»¥è€ƒè™‘å’¨è¯¢åŒ»ç”Ÿæˆ–ç¡çœ ä¸“å®¶, å¯»æ±‚è¿›ä¸€æ­¥çš„å»ºè®®ã€‚
```

#### ä»æœ¬åœ°åŠ è½½æ¨¡å‹

ä»¥ä¸Šä»£ç ä¼šç”± `transformers`
è‡ªåŠ¨ä¸‹è½½æ¨¡å‹å®ç°å’Œå‚æ•°ã€‚å®Œæ•´çš„æ¨¡å‹å®ç°åœ¨ [Hugging Face Hub](https://huggingface.co/THUDM/chatglm3-6b)
ã€‚å¦‚æœä½ çš„ç½‘ç»œç¯å¢ƒè¾ƒå·®ï¼Œä¸‹è½½æ¨¡å‹å‚æ•°å¯èƒ½ä¼šèŠ±è´¹è¾ƒé•¿æ—¶é—´ç”šè‡³å¤±è´¥ã€‚æ­¤æ—¶å¯ä»¥å…ˆå°†æ¨¡å‹ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åä»æœ¬åœ°åŠ è½½ã€‚

ä» Hugging Face Hub
ä¸‹è½½æ¨¡å‹éœ€è¦å…ˆ[å®‰è£…Git LFS](https://docs.github.com/zh/repositories/working-with-files/managing-large-files/installing-git-large-file-storage)
ï¼Œç„¶åè¿è¡Œ

```Shell
git clone https://huggingface.co/THUDM/chatglm3-6b
```

å¦‚æœä»ä½ ä» HuggingFace ä¸‹è½½æ¯”è¾ƒæ…¢ï¼Œä¹Ÿå¯ä»¥ä» [ModelScope](https://modelscope.cn/models/ZhipuAI/chatglm3-6b)
ä¸­ä¸‹è½½ã€‚

### æ¨¡å‹å¾®è°ƒ

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¾®è°ƒ ChatGLM3-6B æ¨¡å‹çš„åŸºç¡€å¥—ä»¶ï¼Œå¯ä»¥ç”¨æ¥å¾®è°ƒ ChatGLM3-6B æ¨¡å‹ã€‚å¾®è°ƒå¥—ä»¶çš„ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒ
[å¾®è°ƒå¥—ä»¶](finetune_demo/README.md)ã€‚

### ç½‘é¡µç‰ˆå¯¹è¯ Demo

![web-demo](resources/web-demo.gif)
å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨åŸºäº Gradio çš„ç½‘é¡µç‰ˆ demoï¼š

```shell
python web_demo_gradio.py
```

![web-demo](resources/web-demo2.png)

å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨åŸºäº Streamlit çš„ç½‘é¡µç‰ˆ demoï¼š

```shell
streamlit run web_demo_streamlit.py
```

ç½‘é¡µç‰ˆ demo ä¼šè¿è¡Œä¸€ä¸ª Web Serverï¼Œå¹¶è¾“å‡ºåœ°å€ã€‚åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¾“å‡ºçš„åœ°å€å³å¯ä½¿ç”¨ã€‚ ç»æµ‹è¯•ï¼ŒåŸºäº Streamlit çš„ç½‘é¡µç‰ˆ Demo ä¼šæ›´æµç•…ã€‚

### å‘½ä»¤è¡Œå¯¹è¯ Demo

![cli-demo](resources/cli-demo.png)

è¿è¡Œä»“åº“ä¸­ [cli_demo.py](basic_demo/cli_demo.py)ï¼š

```shell
python cli_demo.py
```

ç¨‹åºä¼šåœ¨å‘½ä»¤è¡Œä¸­è¿›è¡Œäº¤äº’å¼çš„å¯¹è¯ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥æŒ‡ç¤ºå¹¶å›è½¦å³å¯ç”Ÿæˆå›å¤ï¼Œè¾“å…¥ `clear` å¯ä»¥æ¸…ç©ºå¯¹è¯å†å²ï¼Œè¾“å…¥ `stop` ç»ˆæ­¢ç¨‹åºã€‚

### LangChain Demo

ä»£ç å®ç°è¯·å‚è€ƒ [LangChain Demo](langchain_demo/README.md)ã€‚

#### å·¥å…·è°ƒç”¨

å…³äºå·¥å…·è°ƒç”¨çš„æ–¹æ³•è¯·å‚è€ƒ [å·¥å…·è°ƒç”¨](tools_using_demo/README.md)ã€‚

#### OpenAI API / Zhipu API Demo

æˆ‘ä»¬å·²ç»æ¨å‡ºäº† OpenAI / ZhipuAI æ ¼å¼çš„ å¼€æºæ¨¡å‹ API éƒ¨ç½²ä»£ç ï¼Œå¯ä»¥ä½œä¸ºä»»æ„åŸºäº ChatGPT çš„åº”ç”¨çš„åç«¯ã€‚
ç›®å‰ï¼Œå¯ä»¥é€šè¿‡è¿è¡Œä»“åº“ä¸­çš„ [api_server.py](openai_api_demo/api_server.py) è¿›è¡Œéƒ¨ç½²

```shell
cd openai_api_demo
python api_server.py
```

åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¹¦å†™äº†ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œç”¨æ¥æµ‹è¯•APIè°ƒç”¨çš„æ€§èƒ½ã€‚

+ OpenAI æµ‹è¯•è„šæœ¬ï¼š[openai_api_request.py](openai_api_demo/openai_api_request.py)
+ ZhipuAI æµ‹è¯•è„šæœ¬ï¼š[zhipu_api_request.py](openai_api_demo/zhipu_api_request.py)
+ ä½¿ç”¨Curlè¿›è¡Œæµ‹è¯•
  
+ chat Curl æµ‹è¯•
```shell
curl -X POST "http://127.0.0.1:8000/v1/chat/completions" \
-H "Content-Type: application/json" \
-d "{\"model\": \"chatglm3-6b\", \"messages\": [{\"role\": \"system\", \"content\": \"You are ChatGLM3, a large language model trained by Zhipu.AI. Follow the user's instructions carefully. Respond using markdown.\"}, {\"role\": \"user\", \"content\": \"ä½ å¥½ï¼Œç»™æˆ‘è®²ä¸€ä¸ªæ•…äº‹ï¼Œå¤§æ¦‚100å­—\"}], \"stream\": false, \"max_tokens\": 100, \"temperature\": 0.8, \"top_p\": 0.8}"
````

+ Standard openai interface agent-chat Curl æµ‹è¯•
```shell
curl -X POST "http://127.0.0.1:8000/v1/chat/completions" \
-H "Content-Type: application/json" \
-d "{\"model\": \"chatglm3-6b\", \"messages\": [{\"role\": \"user\", \"content\": \"37ä¹˜ä»¥8åŠ 7é™¤2ç­‰äºå¤šå°‘ï¼Ÿ\"}], "tools": [{"name": "track", "description": "è¿½è¸ªæŒ‡å®šè‚¡ç¥¨çš„å®æ—¶ä»·æ ¼",
          "parameters": {"type": "object", "properties": {"symbol": {"description": "éœ€è¦è¿½è¸ªçš„è‚¡ç¥¨ä»£ç "}},
                         "required": []}},
         {"name": "Calculator", "description": "æ•°å­¦è®¡ç®—å™¨ï¼Œè®¡ç®—æ•°å­¦é—®é¢˜",
          "parameters": {"type": "object", "properties": {"symbol": {"description": "è¦è®¡ç®—çš„æ•°å­¦å…¬å¼"}},
                         "required": []}}
         ], \"stream\": true, \"max_tokens\": 100, \"temperature\": 0.8, \"top_p\": 0.8}"
````

+ Openai style custom interface agent-chat Curl æµ‹è¯•ï¼ˆä½ éœ€è¦å®ç°è‡ªå®šä¹‰çš„å·¥å…·æè¿°è„šæœ¬openai_api_demo/tools/schema.pyçš„å†…å®¹ï¼Œå¹¶ä¸”å°†api_server.pyä¸­AGENT_CONTROLLERæŒ‡å®šä¸º'true'ï¼‰ï¼š
```shell
curl -X POST "http://127.0.0.1:8000/v1/chat/completions" \
-H "Content-Type: application/json" \
-d "{\"model\": \"chatglm3-6b\", \"messages\": [{\"role\": \"user\", \"content\": \"37ä¹˜ä»¥8åŠ 7é™¤2ç­‰äºå¤šå°‘ï¼Ÿ\"}], \"stream\": true, \"max_tokens\": 100, \"temperature\": 0.8, \"top_p\": 0.8}"
````
è¯¥æ¥å£ç”¨äºopenaié£æ ¼çš„è‡ªå®šä¹‰å·¥å…·ç®±çš„è‡ªä¸»è°ƒåº¦ã€‚å…·æœ‰è°ƒåº¦å¼‚å¸¸çš„è‡ªå¤„ç†å›å¤èƒ½åŠ›ï¼Œæ— éœ€å¦å¤–å®ç°è°ƒåº¦ç®—æ³•ï¼Œç”¨æˆ·æ— éœ€api_keyã€‚


+ ä½¿ç”¨Pythonè¿›è¡Œæµ‹è¯•

```shell
cd openai_api_demo
python openai_api_request.py
```

å¦‚æœæµ‹è¯•æˆåŠŸï¼Œåˆ™æ¨¡å‹åº”è¯¥è¿”å›ä¸€æ®µæ•…äº‹ã€‚

## ä½æˆæœ¬éƒ¨ç½²

### æ¨¡å‹é‡åŒ–

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡å‹ä»¥ FP16 ç²¾åº¦åŠ è½½ï¼Œè¿è¡Œä¸Šè¿°ä»£ç éœ€è¦å¤§æ¦‚ 13GB æ˜¾å­˜ã€‚å¦‚æœä½ çš„ GPU æ˜¾å­˜æœ‰é™ï¼Œå¯ä»¥å°è¯•ä»¥é‡åŒ–æ–¹å¼åŠ è½½æ¨¡å‹ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š

```python
model = AutoModel.from_pretrained("THUDM/chatglm3-6b", trust_remote_code=True).quantize(4).cuda()
```

æ¨¡å‹é‡åŒ–ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½æŸå¤±ï¼Œç»è¿‡æµ‹è¯•ï¼ŒChatGLM3-6B åœ¨ 4-bit é‡åŒ–ä¸‹ä»ç„¶èƒ½å¤Ÿè¿›è¡Œè‡ªç„¶æµç•…çš„ç”Ÿæˆã€‚

### CPU éƒ¨ç½²

å¦‚æœä½ æ²¡æœ‰ GPU ç¡¬ä»¶çš„è¯ï¼Œä¹Ÿå¯ä»¥åœ¨ CPU ä¸Šè¿›è¡Œæ¨ç†ï¼Œä½†æ˜¯æ¨ç†é€Ÿåº¦ä¼šæ›´æ…¢ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼ˆéœ€è¦å¤§æ¦‚ 32GB å†…å­˜ï¼‰

```python
model = AutoModel.from_pretrained("THUDM/chatglm3-6b", trust_remote_code=True).float()
```

### Mac éƒ¨ç½²

å¯¹äºæ­è½½äº† Apple Silicon æˆ–è€… AMD GPU çš„ Macï¼Œå¯ä»¥ä½¿ç”¨ MPS åç«¯æ¥åœ¨ GPU ä¸Šè¿è¡Œ ChatGLM3-6Bã€‚éœ€è¦å‚è€ƒ Apple
çš„ [å®˜æ–¹è¯´æ˜](https://developer.apple.com/metal/pytorch) å®‰è£… PyTorch-Nightlyï¼ˆæ­£ç¡®çš„ç‰ˆæœ¬å·åº”è¯¥æ˜¯2.x.x.dev2023xxxxï¼Œè€Œä¸æ˜¯
2.x.xï¼‰ã€‚

ç›®å‰åœ¨ MacOS ä¸Šåªæ”¯æŒ[ä»æœ¬åœ°åŠ è½½æ¨¡å‹](README.md#ä»æœ¬åœ°åŠ è½½æ¨¡å‹)ã€‚å°†ä»£ç ä¸­çš„æ¨¡å‹åŠ è½½æ”¹ä¸ºä»æœ¬åœ°åŠ è½½ï¼Œå¹¶ä½¿ç”¨ mps åç«¯ï¼š

```python
model = AutoModel.from_pretrained("your local path", trust_remote_code=True).to('mps')
```

åŠ è½½åŠç²¾åº¦çš„ ChatGLM3-6B æ¨¡å‹éœ€è¦å¤§æ¦‚ 13GB å†…å­˜ã€‚å†…å­˜è¾ƒå°çš„æœºå™¨ï¼ˆæ¯”å¦‚ 16GB å†…å­˜çš„ MacBook
Proï¼‰ï¼Œåœ¨ç©ºä½™å†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨ç¡¬ç›˜ä¸Šçš„è™šæ‹Ÿå†…å­˜ï¼Œå¯¼è‡´æ¨ç†é€Ÿåº¦ä¸¥é‡å˜æ…¢ã€‚

### å¤šå¡éƒ¨ç½²

å¦‚æœä½ æœ‰å¤šå¼  GPUï¼Œä½†æ˜¯æ¯å¼  GPU çš„æ˜¾å­˜å¤§å°éƒ½ä¸è¶³ä»¥å®¹çº³å®Œæ•´çš„æ¨¡å‹ï¼Œé‚£ä¹ˆå¯ä»¥å°†æ¨¡å‹åˆ‡åˆ†åœ¨å¤šå¼ GPUä¸Šã€‚é¦–å…ˆå®‰è£…
accelerate: `pip install accelerate`ï¼Œç„¶åå³å¯æ­£å¸¸åŠ è½½æ¨¡å‹ã€‚

### OpenVINO Demo

ChatGLM3-6B å·²ç»æ”¯æŒä½¿ç”¨ OpenVINO
å·¥å…·åŒ…è¿›è¡ŒåŠ é€Ÿæ¨ç†ï¼Œåœ¨è‹±ç‰¹å°”çš„GPUå’ŒGPUè®¾å¤‡ä¸Šæœ‰è¾ƒå¤§æ¨ç†é€Ÿåº¦æå‡ã€‚å…·ä½“ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒ [OpenVINO Demo](Intel_device_demo/openvino_demo/README.md)ã€‚

### TensorRT-LLM Demo

ChatGLM3-6Bå·²ç»æ”¯æŒä½¿ç”¨ TensorRT-LLM
å·¥å…·åŒ…è¿›è¡ŒåŠ é€Ÿæ¨ç†ï¼Œæ¨¡å‹æ¨ç†é€Ÿåº¦å¾—åˆ°å¤šå€çš„æå‡ã€‚å…·ä½“ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒ [TensorRT-LLM Demo](tensorrt_llm_demo/tensorrt_llm_cli_demo.py)
å’Œ å®˜æ–¹æŠ€æœ¯æ–‡æ¡£ã€‚

## å¼•ç”¨

å¦‚æœä½ è§‰å¾—æˆ‘ä»¬çš„å·¥ä½œæœ‰å¸®åŠ©çš„è¯ï¼Œè¯·è€ƒè™‘å¼•ç”¨ä¸‹åˆ—è®ºæ–‡ã€‚

```
@article{zeng2022glm,
  title={Glm-130b: An open bilingual pre-trained model},
  author={Zeng, Aohan and Liu, Xiao and Du, Zhengxiao and Wang, Zihan and Lai, Hanyu and Ding, Ming and Yang, Zhuoyi and Xu, Yifan and Zheng, Wendi and Xia, Xiao and others},
  journal={arXiv preprint arXiv:2210.02414},
  year={2022}
}
```

```
@inproceedings{du2022glm,
  title={GLM: General Language Model Pretraining with Autoregressive Blank Infilling},
  author={Du, Zhengxiao and Qian, Yujie and Liu, Xiao and Ding, Ming and Qiu, Jiezhong and Yang, Zhilin and Tang, Jie},
  booktitle={Proceedings of the 60th Annual Meeting of the Association for Computational Linguistics (Volume 1: Long Papers)},
  pages={320--335},
  year={2022}
}
```
